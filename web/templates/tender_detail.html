{% extends "base.html" %}
{% block title %}–¢–µ–Ω–¥–µ—Ä {{ tender.id }} ‚Äî TenderBot Admin{% endblock %}
{% block header_title %}–¢–µ–Ω–¥–µ—Ä{% endblock %}
{% block content %}
<div class="page-header">
    <h2 class="page-title">{{ tender.title }}</h2>
    <p class="page-subtitle">ID {{ tender.id }} ¬∑ {{ tender.status|translate_status }}</p>
</div>
<div class="detail-actions">
    <a href="/tenders/{{ tender.id }}/edit" class="btn btn-warning">‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</a>
    <a href="/tenders" class="btn btn-secondary">‚Üê –ö —Å–ø–∏—Å–∫—É</a>
    <form method="post" action="/tenders/{{ tender.id }}/delete" style="display: inline;" onsubmit="return confirm('–£–¥–∞–ª–∏—Ç—å —Ç–µ–Ω–¥–µ—Ä –±–µ–∑–≤–æ–∑–≤—Ä–∞—Ç–Ω–æ? –í—Å–µ –æ—Ç–∫–ª–∏–∫–∏ –ø–æ –Ω–µ–º—É –±—É–¥—É—Ç —É–¥–∞–ª–µ–Ω—ã.');">
        <button type="submit" class="btn btn-danger">üóë –£–¥–∞–ª–∏—Ç—å</button>
    </form>
</div>
<div class="detail-info">
    <p><strong>ID:</strong> {{ tender.id }}</p>
    <p><strong>–°—Ç–∞—Ç—É—Å:</strong> <span class="badge badge-neutral">{{ tender.status|translate_status }}</span></p>
    <p><strong>–ì–æ—Ä–æ–¥:</strong> {{ tender.city }}</p>
    <p><strong>–ö–∞—Ç–µ–≥–æ—Ä–∏—è:</strong> {{ tender.category }}</p>
    <p><strong>–ë—é–¥–∂–µ—Ç:</strong> {{ tender.budget or "‚Äî" }}</p>
    <p><strong>–î–µ–¥–ª–∞–π–Ω:</strong> {% if tender.deadline %}{{ tender.deadline.strftime('%d.%m.%Y %H:%M') }}{% else %}‚Äî{% endif %}</p>
    <p><strong>–°–æ–∑–¥–∞—Ç–µ–ª—å:</strong> {% if tender.creator %}<a href="/users/{{ tender.creator.id }}">{{ tender.creator.full_name }}</a> (ID {{ tender.creator.id }}){% else %}‚Äî{% endif %}</p>
    <p><strong>–û–ø–∏—Å–∞–Ω–∏–µ:</strong><br>{{ tender.description }}</p>
</div>
<div class="card">
    <h3 class="card-title">–ò–∑–º–µ–Ω–∏—Ç—å —Å—Ç–∞—Ç—É—Å</h3>
    <form method="post" action="/tenders/{{ tender.id }}/status" class="form-inline">
        <select name="new_status" class="form-select" style="width: auto; min-width: 140px;">
            {% for s in statuses %}
            <option value="{{ s }}" {% if tender.status == s %}selected{% endif %}>{{ s|translate_status }}</option>
            {% endfor %}
        </select>
        <button type="submit" class="btn btn-primary">–ò–∑–º–µ–Ω–∏—Ç—å</button>
    </form>
</div>
<div class="card">
    <h3 class="card-title">–û—Ç–∫–ª–∏–∫–∏ ({{ tender.applications|length }})</h3>
    {% if tender.applications %}
    <div class="table-wrap">
        <table class="table">
            <thead>
                <tr>
                    <th>ID</th>
                    <th>–ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å</th>
                    <th>–¢–µ–ª–µ—Ñ–æ–Ω</th>
                    <th>–ì–æ—Ä–æ–¥</th>
                    <th>–°—Ç–∞—Ç—É—Å</th>
                    <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                </tr>
            </thead>
            <tbody>
                {% for a in tender.applications %}
                <tr>
                    <td>{{ a.id }}</td>
                    <td><a href="/users/{{ a.user.id }}">{{ a.user.full_name }}</a></td>
                    <td>{{ a.user.phone }}</td>
                    <td>{{ a.user.city }}</td>
                    <td>
                        {% if a.status == "applied" %}<span class="badge badge-warning">‚è≥ –û–∂–∏–¥–∞–µ—Ç</span>{% endif %}
                        {% if a.status == "selected" %}<span class="badge badge-success">‚úÖ –í—ã–±—Ä–∞–Ω</span>{% endif %}
                        {% if a.status == "rejected" %}<span class="badge badge-danger">‚ùå –û—Ç–∫–ª–æ–Ω—ë–Ω</span>{% endif %}
                    </td>
                    <td>
                        {% if a.status == "applied" %}
                        <form method="post" action="/applications/{{ a.id }}/select" style="display: inline-block;">
                            <button type="submit" class="btn btn-success btn-sm">‚úÖ –í—ã–±—Ä–∞—Ç—å</button>
                        </form>
                        <form method="post" action="/applications/{{ a.id }}/reject" style="display: inline-block;">
                            <button type="submit" class="btn btn-danger btn-sm">‚ùå –û—Ç–∫–ª–æ–Ω–∏—Ç—å</button>
                        </form>
                        {% endif %}
                        <form method="post" action="/applications/{{ a.id }}/delete" style="display: inline-block;" onsubmit="return confirm('–£–¥–∞–ª–∏—Ç—å –æ—Ç–∫–ª–∏–∫?');">
                            <button type="submit" class="btn btn-danger btn-sm">üóë</button>
                        </form>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    {% else %}
    <p class="empty-state">–û—Ç–∫–ª–∏–∫–æ–≤ –ø–æ–∫–∞ –Ω–µ—Ç.</p>
    {% endif %}
</div>
{% endblock %}
