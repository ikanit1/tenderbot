{% extends "base.html" %}
{% block title %}–¢–µ–Ω–¥–µ—Ä {{ tender.id }} ‚Äî TenderBot Admin{% endblock %}
{% block content %}
<h1>{{ tender.title }}</h1>
<div style="margin-bottom: 1rem;">
    <a href="/tenders/{{ tender.id }}/edit" style="padding: 0.5rem 1rem; background: #ffc107; color: black; text-decoration: none; border-radius: 4px; margin-right: 0.5rem;">‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</a>
    <a href="/tenders" style="padding: 0.5rem 1rem; background: #6c757d; color: white; text-decoration: none; border-radius: 4px; margin-right: 0.5rem;">‚Üê –ö —Å–ø–∏—Å–∫—É</a>
    <form method="post" action="/tenders/{{ tender.id }}/delete" style="display: inline;" onsubmit="return confirm('–£–¥–∞–ª–∏—Ç—å —Ç–µ–Ω–¥–µ—Ä –±–µ–∑–≤–æ–∑–≤—Ä–∞—Ç–Ω–æ? –í—Å–µ –æ—Ç–∫–ª–∏–∫–∏ –ø–æ –Ω–µ–º—É –±—É–¥—É—Ç —É–¥–∞–ª–µ–Ω—ã.');">
        <button type="submit" style="padding: 0.5rem 1rem; background: #dc3545; color: white; border: none; cursor: pointer; border-radius: 4px;">üóë –£–¥–∞–ª–∏—Ç—å</button>
    </form>
</div>

<div style="background: #f8f9fa; padding: 1rem; border-radius: 4px; margin-bottom: 1rem;">
    <p><strong>ID:</strong> {{ tender.id }}</p>
    <p><strong>–°—Ç–∞—Ç—É—Å:</strong> {{ tender.status }}</p>
    <p><strong>–ì–æ—Ä–æ–¥:</strong> {{ tender.city }}</p>
    <p><strong>–ö–∞—Ç–µ–≥–æ—Ä–∏—è:</strong> {{ tender.category }}</p>
    <p><strong>–ë—é–¥–∂–µ—Ç:</strong> {{ tender.budget or "‚Äî" }}</p>
    <p><strong>–î–µ–¥–ª–∞–π–Ω:</strong> {% if tender.deadline %}{{ tender.deadline.strftime('%d.%m.%Y %H:%M') }}{% else %}‚Äî{% endif %}</p>
    <p><strong>–°–æ–∑–¥–∞—Ç–µ–ª—å:</strong> {% if tender.creator %}{{ tender.creator.full_name }} (ID {{ tender.creator.id }}){% else %}‚Äî{% endif %}</p>
    <p><strong>–û–ø–∏—Å–∞–Ω–∏–µ:</strong><br>{{ tender.description }}</p>
</div>

<div style="margin-bottom: 1rem;">
    <h3>–ò–∑–º–µ–Ω–∏—Ç—å —Å—Ç–∞—Ç—É—Å:</h3>
    <form method="post" action="/tenders/{{ tender.id }}/status" style="display: inline-block;">
        <select name="new_status" style="padding: 0.5rem;">
            {% for s in statuses %}
            <option value="{{ s }}" {% if tender.status == s %}selected{% endif %}>{{ s }}</option>
            {% endfor %}
        </select>
        <button type="submit" style="padding: 0.5rem 1rem; background: #007bff; color: white; border: none; cursor: pointer; border-radius: 4px; margin-left: 0.5rem;">–ò–∑–º–µ–Ω–∏—Ç—å</button>
    </form>
</div>

<h2>–û—Ç–∫–ª–∏–∫–∏ ({{ tender.applications|length }})</h2>
{% if tender.applications %}
<table>
    <tr><th>ID</th><th>–ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å</th><th>–¢–µ–ª–µ—Ñ–æ–Ω</th><th>–ì–æ—Ä–æ–¥</th><th>–°—Ç–∞—Ç—É—Å</th><th>–î–µ–π—Å—Ç–≤–∏—è</th></tr>
    {% for a in tender.applications %}
    <tr>
        <td>{{ a.id }}</td>
        <td><a href="/users/{{ a.user.id }}">{{ a.user.full_name }}</a></td>
        <td>{{ a.user.phone }}</td>
        <td>{{ a.user.city }}</td>
        <td>
            {% if a.status == "applied" %}<span style="color: orange;">‚è≥ –û–∂–∏–¥–∞–µ—Ç</span>{% endif %}
            {% if a.status == "selected" %}<span style="color: green;">‚úÖ –í—ã–±—Ä–∞–Ω</span>{% endif %}
            {% if a.status == "rejected" %}<span style="color: red;">‚ùå –û—Ç–∫–ª–æ–Ω—ë–Ω</span>{% endif %}
        </td>
        <td>
            {% if a.status == "applied" %}
            <form method="post" action="/applications/{{ a.id }}/select" style="display: inline-block;">
                <button type="submit" style="padding: 0.25rem 0.5rem; background: #28a745; color: white; border: none; cursor: pointer; border-radius: 3px; font-size: 0.9em;">‚úÖ –í—ã–±—Ä–∞—Ç—å</button>
            </form>
            <form method="post" action="/applications/{{ a.id }}/reject" style="display: inline-block;">
                <button type="submit" style="padding: 0.25rem 0.5rem; background: #dc3545; color: white; border: none; cursor: pointer; border-radius: 3px; font-size: 0.9em; margin-left: 0.25rem;">‚ùå –û—Ç–∫–ª–æ–Ω–∏—Ç—å</button>
            </form>
            {% endif %}
            <form method="post" action="/applications/{{ a.id }}/delete" style="display: inline-block; margin-left: 0.25rem;" onsubmit="return confirm('–£–¥–∞–ª–∏—Ç—å –æ—Ç–∫–ª–∏–∫?');">
                <button type="submit" style="padding: 0.25rem 0.5rem; background: #6c757d; color: white; border: none; cursor: pointer; border-radius: 3px; font-size: 0.85em;">üóë</button>
            </form>
        </td>
    </tr>
    {% endfor %}
</table>
{% else %}
<p>–û—Ç–∫–ª–∏–∫–æ–≤ –ø–æ–∫–∞ –Ω–µ—Ç.</p>
{% endif %}
{% endblock %}
