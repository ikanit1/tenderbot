{% extends "base.html" %}
{% block title %}–ß–∞—Ç #{{ ticket.id }} ‚Äî {{ ticket.user.full_name }}{% endblock %}
{% block header_title %}–ß–∞—Ç #{{ ticket.id }}{% endblock %}
{% block content %}
<div class="chat-header">
    <div>
        <a href="/support" class="btn btn-ghost btn-sm" style="margin-right: 0.5rem;">‚Üê –ö —Å–ø–∏—Å–∫—É</a>
        <strong>{{ ticket.user.full_name }}</strong> (Telegram ID: {{ ticket.user.tg_id }})
        {% if ticket.status == 'new' %}<span class="badge badge-danger">üÜï –ù–æ–≤—ã–π</span>{% endif %}
        {% if ticket.status == 'in_progress' %}<span class="badge badge-warning">‚è≥ –í –ø—Ä–æ—Ü–µ—Å—Å–µ</span>{% endif %}
        {% if ticket.status == 'closed' %}<span class="badge badge-neutral">üìÅ –ó–∞–∫—Ä—ã—Ç</span>{% endif %}
    </div>
    {% if ticket.status != 'closed' %}
    <form method="post" action="/support/{{ ticket.id }}/close" style="display: inline;">
        <button type="submit" class="btn btn-secondary">–ó–∞–∫—Ä—ã—Ç—å —Ç–∏–∫–µ—Ç</button>
    </form>
    {% endif %}
</div>
<div class="chat-messages">
    {% for m in messages %}
    <div class="msg {{ m.author }}">
        <div>{{ m.text|e }}</div>
        <div class="msg-meta">{% if m.author == 'user' %}–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å{% elif m.author == 'admin' %}–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä{% else %}{{ m.author }}{% endif %} ¬∑ {{ m.created_at.strftime('%d.%m.%Y %H:%M') if m.created_at else '' }}</div>
    </div>
    {% endfor %}
    {% if not messages %}
    <p class="empty-state">–ù–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–π.</p>
    {% endif %}
</div>
{% if ticket.status != 'closed' %}
<form method="post" action="/support/{{ ticket.id }}/reply" class="chat-form">
    <textarea name="text" placeholder="–í–≤–µ–¥–∏—Ç–µ –æ—Ç–≤–µ—Ç..." required></textarea>
    <button type="submit" class="btn btn-success">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
</form>
<div class="templates">
    <span>–®–∞–±–ª–æ–Ω—ã:</span>
    <button type="button" onclick="var t=document.querySelector('textarea[name=text]'); t.value='–ó–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ! –ß–µ–º –º–æ–≥—É –ø–æ–º–æ—á—å?'; t.focus();">–ó–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ!</button>
    <button type="button" onclick="document.querySelector('textarea[name=text]').value='–í–∞—à –≤–æ–ø—Ä–æ—Å –ø—Ä–∏–Ω—è—Ç –≤ —Ä–∞–±–æ—Ç—É.';">–ü—Ä–∏–Ω—è—Ç –≤ —Ä–∞–±–æ—Ç—É</button>
    <button type="button" onclick="document.querySelector('textarea[name=text]').value='–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø—Ä–∏–ª–æ–∂–∏—Ç–µ —Å–∫—Ä–∏–Ω—à–æ—Ç –∏–ª–∏ —É—Ç–æ—á–Ω–∏—Ç–µ –¥–µ—Ç–∞–ª–∏.';">–£—Ç–æ—á–Ω–∏—Ç–µ –¥–µ—Ç–∞–ª–∏</button>
    <button type="button" onclick="document.querySelector('textarea[name=text]').value='–°–ø–∞—Å–∏–±–æ –∑–∞ –æ–±—Ä–∞—â–µ–Ω–∏–µ. –¢–∏–∫–µ—Ç –∑–∞–∫—Ä—ã—Ç.';">–ó–∞–∫—Ä—ã—Ç—å —Ç–∏–∫–µ—Ç</button>
</div>
{% endif %}
{% endblock %}
